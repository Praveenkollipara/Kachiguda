<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>{{ title or "Kachiguda Junction" }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="{{ url_for('static', filename='styles.css', v=13) }}" rel="stylesheet" />
</head>
<body>
  <nav class="topbar">
    <div class="brand">
      <img src="{{ url_for('static', filename='Kjlogo2.png') }}" alt="Kachiguda Junction" class="logo-full">
    </div>

    <div class="links">
      <a href="{{ url_for('home') }}">Home</a>
      <a href="{{ url_for('add_waitlist_form') }}">Add to Waitlist</a>

      {% if is_admin %}
        <a href="{{ url_for('waitlist_admin') }}">Waitlist</a>

        {# === Only on the waitlist page === #}
        {% if request.endpoint == 'waitlist_admin' %}
          <a href="{{ url_for('media_manage') }}" class="btn ghost small">Media Manager</a>

          <!-- Start/Stop Display -->
          <form method="post" action="{{ url_for('display_start') }}" style="display:inline">
            {% if display_mode != 'waitlist' %}
            <button type="submit" class="btn small info">Start Display</button>
            {% endif %}
          </form>

          <form method="post" action="{{ url_for('display_stop') }}" style="display:inline">
            {% if display_mode == 'waitlist' %}
            <button type="submit" class="btn small danger">Stop Display</button>
            {% endif %}
          </form>
        {% endif %}

        <!-- Logout -->
        <form method="post" action="{{ url_for('admin_logout') }}" style="display:inline">
          <button type="submit" class="btn ghost small">Logout</button>
        </form>
      {% else %}
        <a href="{{ url_for('admin_login') }}">Admin</a>
      {% endif %}

      <button class="theme" id="themeBtn" title="Switch theme">ðŸŽ¨ Theme</button>
    </div>
  </nav>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <ul class="flash">
        {% for category, msg in messages %}
          <li class="flash-{{ category }}">{{ msg }}</li>
        {% endfor %}
      </ul>
    {% endif %}
  {% endwith %}

  {% block content %}{% endblock %}

  <script>
    (function(){
      // theme toggle (persisted)
      const key="lightapp-theme";
      const saved=localStorage.getItem(key);
      if(saved) document.documentElement.setAttribute("data-theme", saved);
      document.getElementById("themeBtn")?.addEventListener("click", ()=>{
        const cur=document.documentElement.getAttribute("data-theme");
        const next=(cur==="sunset")? "" : "sunset";
        if(next) document.documentElement.setAttribute("data-theme", next);
        else document.documentElement.removeAttribute("data-theme");
        localStorage.setItem(key, next);
      });
      // (Upload removed from navbar; handled on Media Manager page)
    })();
  </script>
</body>
</html>
